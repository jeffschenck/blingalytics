(function(a){jQuery.fn.blingalytics=function(b){var c={url:"/report/",reportCodeName:"report",callback:a.noop};if(b){a.extend(c,b)}return this.each(function(){var d=a(this);d.empty().addClass("bl_container");var f=a('<ul class="errors"></ul>');f.prependTo(d);var e={metadata:"1",report:c.reportCodeName};a.getJSON(c.url,e,function(q){if(q.errors.length){f.empty();for(var o=0;o<q.errors.length;o++){f.append("<li>"+q.errors[o]+"</li>")}return}var h=q.header;var k=q.default_sort;var l=[];var m=[];var p="";var s="";for(var o=0;o<h.length;o++){l.push({bSearchable:false,bSortable:h[o].sortable,sClass:"",sName:h[o].key,sTitle:h[o].label,aTargets:[o]});var j=h[o].className||"";j=h[o].hidden?j+" bl_hidden":j;m.push(j);p+='<th class="'+j+'">'+h[o].label+"</th>";s+='<th class="'+j+'"></th>';if(h[o].key==k[0]){k=([parseInt(o),k[1]])}}var g=a('<ul class="widgets"></ul>');d.append(g);for(var o=0;o<q.widgets.length;o++){g.append("<li>"+q.widgets[o]+"</li>")}a("<button>Run Report</button>").appendTo(g).click(function(){n.fnSort([k])});var t=a('<table class="bl_table display"><thead><tr>'+p+"</tr></thead><tfoot><tr>"+s+"</tr></tfoot><tbody></tbody></table>");d.append(t);function r(i,v,w){var u=i+"&"+g.find("input, select, textarea").serialize();a.getJSON(u,v,function(z){if(z.poll){setTimeout(r,500)}else{if(z.errors.length){f.empty();for(var y=0;y<z.errors.length;y++){f.append("<li>"+z.errors[y]+"</li>")}w({iTotalRecords:0,iTotalDisplayRecords:0,aaData:[]})}else{var x=t.find("tfoot th");for(var y=0;y<z.footer.length;y++){x.eq(y).html(z.footer[y])}w(z)}}})}var n=t.dataTable({aoColumnDefs:l,sPaginationType:"full_numbers",bAutoWidth:false,bFilter:false,bJQueryUI:true,bProcessing:true,bStateSave:true,bServerSide:true,sAjaxSource:c.url+"?report="+c.reportCodeName,aaSorting:[k],iDeferLoading:0,iDisplayLength:25,fnRowCallback:function(y,v,u){var x=y.children;for(var w=0;w<x.length;w++){x[w].className+=m[w]}return y},fnServerData:r,fnHeaderCallback:function(w,y,v,u,i){var x=a(w);x.find("th").removeClass("sorting");x.find("th:has(.ui-icon-triangle-1-n, .ui-icon-triangle-1-s)").addClass("sorting")}});c.callback()})})}})(jQuery);