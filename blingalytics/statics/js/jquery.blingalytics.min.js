(function(a){jQuery.fn.blingalytics=function(b){var c={url:"/report/",reportCodeName:"report"};if(b){a.extend(c,b)}return this.each(function(){var d=a(this);d.empty().addClass("bl_container");var f=a('<ul class="errors"></ul>');f.prependTo(d);var e={metadata:"1",report:c.reportCodeName};a.getJSON(c.url,e,function(q){if(q.errors.length){f.empty();for(var o=0;o<q.errors.length;o++){f.append("<li>"+q.errors[o]+"</li>")}return}var h=q.header;var k=q.default_sort;var l=[];var m=[];var p="";var r="";for(var o=0;o<h.length;o++){l.push({bSearchable:false,bSortable:h[o].sortable,sClass:"hello",sName:h[o].key,sTitle:h[o].label,aTargets:[o]});var j=h[o].className||"";j=h[o].hidden?j+" bl_hidden":j;m.push(j);p+='<th class="'+j+'">'+h[o].label+"</th>";r+='<th class="'+j+'"></th>';if(h[o].key==k[0]){k=([parseInt(o),k[1]])}}var g=a('<ul class="widgets"></ul>');d.append(g);for(var o=0;o<q.widgets.length;o++){g.append("<li>"+q.widgets[o]+"</li>")}a("<button>Run Report</button>").appendTo(g).click(function(){n.fnSort([k])});var s=a('<table class="bl_table display"><thead><tr>'+p+"</tr></thead><tfoot><tr>"+r+"</tr></tfoot><tbody></tbody></table>");d.append(s);var n=s.dataTable({aoColumnDefs:l,sPaginationType:"full_numbers",bAutoWidth:false,bFilter:false,bJQueryUI:true,bProcessing:true,bStateSave:true,bServerSide:true,sAjaxSource:c.url+"?report="+c.reportCodeName,aaSorting:[k],iDeferLoading:0,iDisplayLength:25,fnRowCallback:function(x,u,t){var w=x.children;for(var v=0;v<w.length;v++){w[v].className+=m[v]}return x},fnServerData:function(i,u,v){var t=i+"&"+g.find("input, select, textarea").serialize();a.getJSON(t,u,function(y){if(y.errors.length){f.empty();for(var x=0;x<y.errors.length;x++){f.append("<li>"+y.errors[x]+"</li>")}v({iTotalRecords:0,iTotalDisplayRecords:0,aaData:[]})}else{var w=s.find("tfoot th");for(var x=0;x<y.footer.length;x++){w.eq(x).html(y.footer[x])}v(y)}})},fnHeaderCallback:function(v,x,u,t,i){var w=a(v);w.find("th").removeClass("sorting");w.find("th:has(.ui-icon-triangle-1-n, .ui-icon-triangle-1-s)").addClass("sorting")}})})})}})(jQuery);